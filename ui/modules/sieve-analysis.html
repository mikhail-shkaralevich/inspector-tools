<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sieve Analysis for Aggregate Blend</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px;
            padding: 5px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 6px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        .input-section {
            margin-bottom: 20px;
        }
        input {
            width: 40px;
            margin: 2px;
            font-size: 12px;
        }
        button {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        #proportions, #sieveTable {
            margin-top: 20px;
        }
        #errorMessage {
            color: red;
            font-size: 14px;
            margin-left: 10px;
            display: inline;
        }
        .blend-value {
            color: green;
        }
    </style>
</head>
<body>
    <h1>Sieve Analysis for Aggregate Blend</h1>
    
    <div class="input-section">
        <h3>Select Number of Stockpiles</h3>
        <select id="numStockpiles" onchange="updateStockpiles()">
            <option value="2">2</option>
            <option value="3" selected>3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
        </select>
    </div>

    <div id="proportions"></div>
    <div>
        <button onclick="calculateBlend()">Calculate Blend</button>
        <span id="errorMessage"></span>
    </div>
    <table id="sieveTable"></table>

    <script>
        const sieveSizes = [
            {mm: '50.8mm', label: '50.8 mm (2")'},
            {mm: '38.1mm', label: '38.1 mm (1 1/2")'},
            {mm: '25.4mm', label: '25.4 mm (1")'},
            {mm: '19mm', label: '19.0 mm (3/4")'},
            {mm: '12.5mm', label: '12.5 mm (1/2")'},
            {mm: '9.5mm', label: '9.5 mm (3/8")'},
            {mm: '4.75mm', label: '4.75 mm (#4)'},
            {mm: '2.36mm', label: '2.36 mm (#8)'},
            {mm: '1.18mm', label: '1.18 mm (#16)'},
            {mm: '0.6mm', label: '0.6 mm (#30)'},
            {mm: '0.3mm', label: '0.3 mm (#50)'},
            {mm: '0.15mm', label: '0.15 mm (#100)'},
            {mm: '0.075mm', label: '0.075 mm (#200)'}
        ];

        const defaultValuesCoarseToFine = [
            [100, 100, 95, 90, 85, 80], // 50.8 mm (2")
            [95, 90, 85, 80, 75, 70],   // 38.1 mm (1 1/2")
            [85, 80, 75, 70, 65, 60],   // 25.4 mm (1")
            [75, 70, 65, 60, 55, 50],   // 19.0 mm (3/4")
            [65, 60, 55, 50, 45, 40],   // 12.5 mm (1/2")
            [55, 50, 45, 40, 35, 30],   // 9.5 mm (3/8")
            [45, 40, 35, 30, 25, 20],   // 4.75 mm (#4)
            [35, 30, 25, 20, 15, 10],   // 2.36 mm (#8)
            [25, 20, 15, 10, 8, 6],     // 1.18 mm (#16)
            [18, 15, 12, 10, 8, 6],     // 0.6 mm (#30)
            [12, 10, 8, 6, 5, 4],       // 0.3 mm (#50)
            [8, 6, 5, 4, 3, 2],         // 0.15 mm (#100)
            [4, 3, 2, 1, 1, 1]          // 0.075 mm (#200)
        ];

        function updateStockpiles() {
            const num = parseInt(document.getElementById('numStockpiles').value);
            generateProportions(num);
            generateTable(num);
            document.getElementById('errorMessage').textContent = '';
        }

        function generateProportions(num) {
            const propDiv = document.getElementById('proportions');
            propDiv.innerHTML = '<h3>Stockpile (SP) Proportions (Coarser to Finer)</h3>';
            const defaultProp = Math.floor(100 / num);
            for (let i = 1; i <= num; i++) {
                const propValue = (i === num) ? (100 - (num - 1) * defaultProp) : defaultProp;
                propDiv.innerHTML += `
                    <label>SP ${i} (%): 
                        <input type="number" id="prop${i}" value="${propValue}" min="0" max="100">
                    </label>
                `;
            }
        }

        function generateTable(num) {
            const table = document.getElementById('sieveTable');
            let html = '<tr><th>Sieve Size</th>';
            for (let i = 1; i <= num; i++) {
                html += `<th>SP ${i}<br>(% Passing)</th>`;
            }
            html += '<th>Blend<br>(% Passing)</th></tr>';

            sieveSizes.forEach((size, index) => {
                html += `<tr><td>${size.label}</td>`;
                for (let i = 1; i <= num; i++) {
                    const valueIndex = Math.min(i - 1, 5);
                    const value = defaultValuesCoarseToFine[index][valueIndex];
                    html += `<td><input type="number" class="sp${i}" value="${value}" min="0" max="100"></td>`;
                }
                html += `<td id="blend-${size.mm}" class="blend-value">-</td></tr>`;
            });

            table.innerHTML = html;
        }

        function calculateBlend() {
            const num = parseInt(document.getElementById('numStockpiles').value);
            const errorMessage = document.getElementById('errorMessage');
            
            // Get proportions
            let proportions = [];
            let sum = 0;
            for (let i = 1; i <= num; i++) {
                const prop = parseFloat(document.getElementById(`prop${i}`).value) / 100;
                proportions.push(prop);
                sum += prop;
            }
            
            // Check if proportions sum to 100%
            if (Math.abs(sum - 1) > 0.01) {
                errorMessage.textContent = 'Proportions must add up to 100%';
                return;
            } else {
                errorMessage.textContent = '';
            }

            // Get sieve values for each stockpile
            let stockpileValues = [];
            for (let i = 1; i <= num; i++) {
                stockpileValues.push(
                    Array.from(document.getElementsByClassName(`sp${i}`))
                        .map(input => parseFloat(input.value))
                );
            }

            // Calculate blend
            sieveSizes.forEach((size, index) => {
                let blendValue = 0;
                for (let i = 0; i < num; i++) {
                    blendValue += stockpileValues[i][index] * proportions[i];
                }
                document.getElementById(`blend-${size.mm}`).textContent = blendValue.toFixed(1);
            });
        }

        // Initialize with default (3 stockpiles)
        updateStockpiles();
    </script>
</body>
</html>