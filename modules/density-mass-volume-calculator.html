<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Density, Mass, and Volume Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            margin-top: 40px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        h1 {
            text-align: left;
        }
        label {
            display: block;
            margin-top: 20px;
        }
        input[type="text"] {
            width: 70%;
            padding: 8px;
            margin-top: 5px;
            box-sizing: border-box;
        }
        input.calculated {
            color: green;
            font-weight: bold;
        }
        .unit {
            font-size: 0.9em;
            color: #555;
            margin-top: 2px;
         }
        .unit-system {
            display: flex;
            justify-content: flex-start;
            gap: 20px;
            margin-top: 20px;
        }
        .mass-group, .volume-group, .density-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }
        .reset-button button {
            padding: 10px 20px;
            background-color: #f44336;
            color: white;
            border: none;
            cursor: pointer;
        }
        .reset-button button:hover {
            background-color: #d32f2f;
        }
        .keypad {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 3px;
            max-width: 300px;
            margin: 0 0 15px 0;
        }
        .key {
            padding: 10px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            cursor: pointer;
            font-size: 16px;
        }
        .key:hover {
            background-color: #e0e0e0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Density, Mass, and Volume Calculator</h1>

        <div class="unit-system">
            <label><input type="radio" name="unitSystem" value="english" checked> English</label>
            <label><input type="radio" name="unitSystem" value="si"> SI</label>
        </div>

        <label>Input 2 Parameters (calculated values in green):</label>
        <div class="density-group">
            <div>
                <input type="text" id="densityInput" placeholder="density" onfocus="setActiveInput(this)">
                <div class="unit" id="densityUnitLabel">Density (lb/ft³)</div>
            </div>
            <span>or</span>
            <div>
                <input type="text" id="specificGravity" placeholder="specific gravity" onfocus="setActiveInput(this)">
                <div class="unit">Specific Gravity</div>
            </div>
        </div>

        <div class="mass-group">
            <div>
                <input type="text" id="massInput1" placeholder="mass" onfocus="setActiveInput(this)">
                <div class="unit" id="massUnit1Label">Mass (lbs)</div>
            </div>
            <span>or</span>
            <div>
                <input type="text" id="massInput2" placeholder="mass" onfocus="setActiveInput(this)">
                <div class="unit" id="massUnit2Label">Mass (tons)</div>
            </div>
        </div>

        <div class="volume-group">
            <div>
                <input type="text" id="volumeInput1" placeholder="volume" onfocus="setActiveInput(this)">
                <div class="unit" id="volumeUnit1Label">Volume (ft³)</div>
            </div>
            <span>or</span>
            <div>
                <input type="text" id="volumeInput2" placeholder="volume" onfocus="setActiveInput(this)">
                <div class="unit" id="volumeUnit2Label">Volume (yd³)</div>
            </div>
        </div>

        <br>
        <div class="keypad">
            <div class="key" onclick="addNumber('1')">1</div>
            <div class="key" onclick="addNumber('2')">2</div>
            <div class="key" onclick="addNumber('3')">3</div>
            <div class="key" onclick="addNumber('4')">4</div>
            <div class="key" onclick="addNumber('5')">5</div>
            <div class="key" onclick="addNumber('6')">6</div>
            <div class="key" onclick="addNumber('7')">7</div>
            <div class="key" onclick="addNumber('8')">8</div>
            <div class="key" onclick="addNumber('9')">9</div>
            <div class="key" onclick="addNumber('0')">0</div>
            <div class="key" onclick="addNumber('.')">.</div>
            <div class="key" onclick="addNumber('C')">C</div>
        </div>

        <div class="reset-button">
            <button onclick="resetValues()">Reset</button>
        </div>
    </div>

    <script>
        const TON_TO_LBS = 2000;
        const YD_TO_FT = 27;
        const DENSITY_OF_WATER_ENGLISH = 62.4;
        const DENSITY_OF_WATER_SI = 1000;
        const KG_TO_G = 1000;
        const M3_TO_CM3 = 1e6;

        function formatNumber(value) {
            const absValue = Math.abs(value);
            if (absValue >= 1e6 || (absValue > 0 && absValue < 0.01)) {
                return value.toExponential(2);
            }
            return value.toFixed(2);
        }

        const densityInput = document.getElementById('densityInput');
        const specificGravityInput = document.getElementById('specificGravity');
        const massInput1 = document.getElementById('massInput1');
        const massInput2 = document.getElementById('massInput2');
        const volumeInput1 = document.getElementById('volumeInput1');
        const volumeInput2 = document.getElementById('volumeInput2');
        const densityUnitLabel = document.getElementById('densityUnitLabel');
        const massUnit1Label = document.getElementById('massUnit1Label');
        const massUnit2Label = document.getElementById('massUnit2Label');
        const volumeUnit1Label = document.getElementById('volumeUnit1Label');
        const volumeUnit2Label = document.getElementById('volumeUnit2Label');
        const unitSystemEnglish = document.querySelector('input[value="english"]');
        const unitSystemSI = document.querySelector('input[value="si"]');

        let activeInput = null;
        let lastInput = null;
        let userInputs = new Set();

        function setActiveInput(input) {
            if (!input.readOnly) {
                activeInput = input;
            } else {
                activeInput = null;
            }
        }

        function addNumber(num) {
            if (activeInput && !activeInput.readOnly) {
                if (num === 'C') {
                    clearLastInput();
                    return;
                }
                let currentValue = activeInput.value || '';
                if (num === '.' && currentValue.includes('.')) {
                    return;
                }
                activeInput.value = currentValue + num;
                if (parseFloat(activeInput.value)) {
                    lastInput = activeInput;
                    userInputs.add(activeInput);
                }
                activeInput.dispatchEvent(new Event('input')); // Trigger input event
            }
        }

        function clearLastInput() {
            if (lastInput && !lastInput.classList.contains('calculated')) {
                lastInput.value = '';
                userInputs.delete(lastInput);
                // Clear paired field if not calculated
                if (lastInput === densityInput && !specificGravityInput.classList.contains('calculated')) {
                    specificGravityInput.value = '';
                } else if (lastInput === specificGravityInput && !densityInput.classList.contains('calculated')) {
                    densityInput.value = '';
                } else if (lastInput === massInput1 && !massInput2.classList.contains('calculated')) {
                    massInput2.value = '';
                } else if (lastInput === massInput2 && !massInput1.classList.contains('calculated')) {
                    massInput1.value = '';
                } else if (lastInput === volumeInput1 && !volumeInput2.classList.contains('calculated')) {
                    volumeInput2.value = '';
                } else if (lastInput === volumeInput2 && !volumeInput1.classList.contains('calculated')) {
                    volumeInput1.value = '';
                }
                lastInput.focus();
                calculate(); // Recalculate after clearing
            }
        }

        function updateUnits() {
            if (unitSystemEnglish.checked) {
                densityUnitLabel.innerText = 'Density (lb/ft³)';
                massUnit1Label.innerText = 'Mass (lbs)';
                massUnit2Label.innerText = 'Mass (tons)';
                volumeUnit1Label.innerText = 'Volume (ft³)';
                volumeUnit2Label.innerText = 'Volume (yd³)';
            } else {
                densityUnitLabel.innerText = 'Density (kg/m³)';
                massUnit1Label.innerText = 'Mass (kg)';
                massUnit2Label.innerText = 'Mass (g)';
                volumeUnit1Label.innerText = 'Volume (m³)';
                volumeUnit2Label.innerText = 'Volume (cm³)';
            }
        }

        function handleDensityInput() {
            const densityValue = parseFloat(densityInput.value);
            const densityOfWater = unitSystemEnglish.checked ? DENSITY_OF_WATER_ENGLISH : DENSITY_OF_WATER_SI;
            if (!isNaN(densityValue) && !densityInput.classList.contains('calculated')) {
                specificGravityInput.value = formatNumber(densityValue / densityOfWater);
            } else if (!specificGravityInput.classList.contains('calculated')) {
                specificGravityInput.value = '';
            }
            calculate();
        }

        function handleSpecificGravityInput() {
            const sgValue = parseFloat(specificGravityInput.value);
            const densityOfWater = unitSystemEnglish.checked ? DENSITY_OF_WATER_ENGLISH : DENSITY_OF_WATER_SI;
            if (!isNaN(sgValue) && !specificGravityInput.classList.contains('calculated')) {
                densityInput.value = formatNumber(sgValue * densityOfWater);
            } else if (!densityInput.classList.contains('calculated')) {
                densityInput.value = '';
            }
            calculate();
        }

        function handleMassInput(activeInput, pairedInput, toPairedFactor) {
            const value = parseFloat(activeInput.value);
            if (!isNaN(value) && !activeInput.classList.contains('calculated')) {
                pairedInput.value = formatNumber(value * toPairedFactor);
            } else if (!pairedInput.classList.contains('calculated')) {
                pairedInput.value = '';
            }
            calculate();
        }

        function handleVolumeInput(activeInput, pairedInput, toPairedFactor) {
            const value = parseFloat(activeInput.value);
            if (!isNaN(value) && !activeInput.classList.contains('calculated')) {
                pairedInput.value = formatNumber(value * toPairedFactor);
            } else if (!pairedInput.classList.contains('calculated')) {
                pairedInput.value = '';
            }
            calculate();
        }

        function calculate() {
            const unitSystem = unitSystemEnglish.checked ? 'english' : 'si';
            const density = parseFloat(densityInput.value);
            const specificGravity = parseFloat(specificGravityInput.value);
            const mass1 = parseFloat(massInput1.value);
            const mass2 = parseFloat(massInput2.value);
            const volume1 = parseFloat(volumeInput1.value);
            const volume2 = parseFloat(volumeInput2.value);

            let mass = unitSystem === 'si' ? (mass1 || mass2 / KG_TO_G) : (mass1 || mass2 * TON_TO_LBS);
            let volume = unitSystem === 'si' ? (volume1 || volume2 / M3_TO_CM3) : (volume1 || volume2 * YD_TO_FT);
            const densityOfWater = unitSystem === 'si' ? DENSITY_OF_WATER_SI : DENSITY_OF_WATER_ENGLISH;
            const finalDensity = density || (specificGravity * densityOfWater);

            if (userInputs.size < 2) {
                // Clear calculated fields if insufficient inputs
                [densityInput, specificGravityInput, massInput1, massInput2, volumeInput1, volumeInput2].forEach(input => {
                    if (!userInputs.has(input) && input.classList.contains('calculated')) {
                        input.value = '';
                        input.classList.remove('calculated');
                        input.readOnly = false;
                    }
                });
                return;
            }

            // Clear only calculated fields before recalculation
            [densityInput, specificGravityInput, massInput1, massInput2, volumeInput1, volumeInput2].forEach(input => {
                if (!userInputs.has(input) && input.classList.contains('calculated')) {
                    input.value = '';
                    input.classList.remove('calculated');
                    input.readOnly = false;
                }
            });

            if (userInputs.has(specificGravityInput) || userInputs.has(densityInput)) {
                if (userInputs.has(massInput1) || userInputs.has(massInput2)) {
                    const calculatedVolume = mass / finalDensity;
                    volumeInput1.value = formatNumber(calculatedVolume);
                    volumeInput1.classList.add('calculated');
                    volumeInput1.readOnly = true;
                    volumeInput2.value = formatNumber(unitSystem === 'english' ? calculatedVolume / YD_TO_FT : calculatedVolume * M3_TO_CM3);
                    volumeInput2.classList.add('calculated');
                    volumeInput2.readOnly = true;
                } else if (userInputs.has(volumeInput1) || userInputs.has(volumeInput2)) {
                    const calculatedMass = finalDensity * volume;
                    massInput1.value = formatNumber(calculatedMass);
                    massInput1.classList.add('calculated');
                    massInput1.readOnly = true;
                    massInput2.value = formatNumber(unitSystem === 'english' ? calculatedMass / TON_TO_LBS : calculatedMass * KG_TO_G);
                    massInput2.classList.add('calculated');
                    massInput2.readOnly = true;
                }
            } else if (userInputs.has(massInput1) || userInputs.has(massInput2)) {
                if (userInputs.has(volumeInput1) || userInputs.has(volumeInput2)) {
                    const calculatedDensity = mass / volume;
                    densityInput.value = formatNumber(calculatedDensity);
                    densityInput.classList.add('calculated');
                    densityInput.readOnly = true;
                    specificGravityInput.value = formatNumber(calculatedDensity / densityOfWater);
                    specificGravityInput.classList.add('calculated');
                    specificGravityInput.readOnly = true;
                }
            }
        }

        function resetValues() {
            [densityInput, specificGravityInput, massInput1, massInput2, volumeInput1, volumeInput2].forEach(input => {
                input.value = '';
                input.classList.remove('calculated');
                input.readOnly = false;
            });
            activeInput = null;
            lastInput = null;
            userInputs.clear();
        }

        unitSystemEnglish.addEventListener('change', () => {
            updateUnits();
            resetValues();
        });
        unitSystemSI.addEventListener('change', () => {
            updateUnits();
            resetValues();
        });

        densityInput.addEventListener('input', handleDensityInput);
        specificGravityInput.addEventListener('input', handleSpecificGravityInput);
        massInput1.addEventListener('input', () => handleMassInput(massInput1, massInput2, unitSystemEnglish.checked ? 1 / TON_TO_LBS : KG_TO_G));
        massInput2.addEventListener('input', () => handleMassInput(massInput2, massInput1, unitSystemEnglish.checked ? TON_TO_LBS : 1 / KG_TO_G));
        volumeInput1.addEventListener('input', () => handleVolumeInput(volumeInput1, volumeInput2, unitSystemEnglish.checked ? 1 / YD_TO_FT : M3_TO_CM3));
        volumeInput2.addEventListener('input', () => handleVolumeInput(volumeInput2, volumeInput1, unitSystemEnglish.checked ? YD_TO_FT : 1 / M3_TO_CM3));

        updateUnits();
        resetValues();
    </script>
</body>
</html>